<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Weekly Wednesday Media</title>
  <link rel="stylesheet" href="./assets/styles.css">
</head>
<body>
  <div class="topbar">
    <div class="container">
      <div class="brand">
        <img class="logo" src="./assets/logo.png" alt="Weekly Wednesday Media logo">
        <div class="brand-text">
          <h1>Weekly Wednesday Media</h1>
          <p>Photo archive</p>
        </div>
      </div>
      <div class="nav">
        <a href="./">Home</a>
        <a href="./">Photos</a>
      </div>
    </div>
  </div>

  <main>
    <div class="container">
      <div class="panel">
        <h2>Gallery</h2>
        <p class="status" id="status">Loading photos…</p>
        <div class="grid" id="grid"></div>
        <div class="footer">© 2026</div>
      </div>
    </div>
  </main>

  <div class="lightbox" id="lightbox" aria-hidden="true">
    <button class="close" id="closeBtn">Close ✕</button>
    <img id="lightboxImg" alt="Expanded photo" />
  </div>

  <script>
    const grid = document.getElementById('grid');
    const statusEl = document.getElementById('status');
    const lightbox = document.getElementById('lightbox');
    const lightboxImg = document.getElementById('lightboxImg');
    const closeBtn = document.getElementById('closeBtn');

    function openLightbox(src){
      lightboxImg.src = src;
      lightbox.classList.add('open');
      lightbox.setAttribute('aria-hidden','false');
    }
    function closeLightbox(){
      lightbox.classList.remove('open');
      lightbox.setAttribute('aria-hidden','true');
      lightboxImg.src = '';
    }
    closeBtn.addEventListener('click', closeLightbox);
    lightbox.addEventListener('click', e => { if (e.target === lightbox) closeLightbox(); });
    window.addEventListener('keydown', e => { if (e.key === 'Escape') closeLightbox(); });

    async function loadPhotos(){
      try{
        const res = await fetch('./photos.json', { cache: 'no-store' });
        if(!res.ok) throw new Error('photos.json missing');
        const entries = await res.json();
        if(!Array.isArray(entries) || entries.length === 0){
          statusEl.textContent = 'No photos listed yet. Add filenames to photos.json.';
          return;
        }
        statusEl.textContent = '';
        entries.forEach(entry => {
          const normalized = typeof entry === 'string' ? { file: entry, caption: entry } : entry;
          if(!normalized?.file) return;
          const tile = document.createElement('div');
          tile.className = 'tile';
          const img = document.createElement('img');
          img.src = `./photos/${normalized.file}`;
          img.alt = normalized.caption || normalized.file;
          img.loading = 'lazy';
          const cap = document.createElement('div');
          cap.className = 'cap';
          cap.textContent = normalized.caption || normalized.file;
          tile.appendChild(img);
          tile.appendChild(cap);
          tile.addEventListener('click', () => openLightbox(img.src));
          grid.appendChild(tile);
        });
      } catch(e){
        statusEl.textContent = 'Could not load photos.json (make sure it exists in the repo root).';
      }
    }
    loadPhotos();
  </script>
</body>
</html>
